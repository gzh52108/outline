(function(t){function e(e){for(var r,i,s=e[0],c=e[1],u=e[2],d=0,f=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&f.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);l&&l(e);while(f.length)f.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},o={app:0},a=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"1b71":function(t,e,n){},"3f86":function(t,e,n){"use strict";n("aa7e")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),n("van-tabbar",{directives:[{name:"show",rawName:"v-show",value:t.showTabbar,expression:"showTabbar"}],attrs:{route:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.menu,(function(e){return n("van-tabbar-item",{key:e.path,attrs:{icon:e.icon,to:e.path,badge:"/cart"===e.path?t.cartlist.length:null}},[t._v(" "+t._s("/mine"===e.path&&t.isLogin?t.userInfo.username:e.text)+" ")])})),1)],1)},a=[],i=n("5530"),s=(n("ac1f"),n("5319"),n("2f62")),c={name:"App",data:function(){return{active:0,showTabbar:!0,menu:[{path:"/home",text:"首页",icon:"wap-home-o"},{path:"/discover",text:"发现",icon:"eye-o"},{path:"/cart",text:"购物车",icon:"cart-o"},{path:"/mine",text:"我的",icon:"manager-o"}]}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(s["d"])(["index","a"])),Object(s["d"])({idx:"index",cartlist2:function(t){return t.cart.cartlist},userInfo2:function(t){return t.user.userInfo}})),Object(s["d"])("user",{user:"userInfo"})),Object(s["c"])(["globalA","totalPrice"])),Object(s["c"])({ga:"globalA",isLogin2:"user/isLogin"})),Object(s["c"])("user",{isLogin3:"isLogin"})),{},{cartlist:function(){return this.$store.state.cart.cartlist},isLogin:function(){return this.$store.getters.isLogin},userInfo:function(){return this.$store.state.user.userInfo}}),created:function(){},methods:{goto:function(t){this.$router.replace(t)}}},u=c,l=(n("034f"),n("2877")),d=Object(l["a"])(u,o,a,!1,null,null,null),f=d.exports,p=n("8c4f"),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-search",{attrs:{placeholder:"请输入搜索关键词",disabled:""},on:{click:t.gotoSearch},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),n("van-swipe",{staticClass:"my-swipe",attrs:{autoplay:3e3,"indicator-color":"white"}},t._l(t.hotlist,(function(e){return n("van-swipe-item",{key:e._id},[n("van-image",{attrs:{height:"100%",width:"100%",fit:"cover",src:t.$request.baseUrl+e.img_url},on:{click:function(n){return t.gotoDetail(e._id)}}})],1)})),1),n("div",{staticStyle:{padding:"10px"}},[n("h4",[t._v("最新商品")]),n("van-row",{attrs:{gutter:"20"}},t._l(t.newlist,(function(e){return n("van-col",{key:e._id,attrs:{span:"12"}},[n("div",{staticStyle:{"text-align":"center"},on:{click:function(n){return t.gotoDetail(e._id)}}},[n("van-image",{attrs:{width:"100",height:"100",src:t.$request.baseUrl+e.img_url}})],1),n("h5",[t._v(t._s(e.goods_name))]),n("p",{staticClass:"price"},[n("del",[t._v(t._s(e.price))]),n("span",[t._v(t._s(e.sales_price))])])])})),1)],1)],1)},g=[],m={name:"Home",data:function(){return{keyword:"双11秒杀活动",newlist:[],hotlist:[]}},beforeRouteEnter:function(t,e,n){console.log("Home.beforeRouteEnter"),n()},beforeRouteLeave:function(t,e,n){console.log("Home.beforeRouteLeave"),n()},created:function(){var t=this;console.log("Home.created",this),this.$request.get("/goods",{params:{total:!1,size:8}}).then((function(e){var n=e.data;t.newlist=n.data})),this.$request.get("/goods",{params:{sort:"views",size:5,total:!1}}).then((function(e){var n=e.data;t.hotlist=n.data}))},methods:{gotoSearch:function(){this.$router.push("/search?keyword="+this.keyword)},gotoDetail:function(t){this.$router.push({name:"Goods",params:{id:t,a:10,b:20}})}}},v=m,b=(n("9ccd"),Object(l["a"])(v,h,g,!1,null,"0d020058",null)),_=b.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("用户登录")]),n("van-form",{on:{submit:t.onSubmit}},[n("van-field",{attrs:{name:"username",label:"用户名",rules:[{required:!0,message:"请填写用户名"}]},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),n("van-field",{attrs:{type:"password",name:"password",label:"密码",rules:[{required:!0,message:"请填写密码"}]},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),n("div",{staticStyle:{margin:"16px"}},[n("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[t._v("免费登录")])],1)],1)],1)},w=[],x=n("1da1"),k=(n("96cf"),{name:"Login",data:function(){return{username:"",password:""}},created:function(){console.log("Login",this)},methods:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(s["b"])(["globalLogin"])),Object(s["b"])({login:"user/login",login2:function(){var t=Object(x["a"])(regeneratorRuntime.mark((function t(e,n){var r,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e("user/login",n);case 2:r=t.sent,200===r.code&&(this.$toast("登录成功"),o=this.$route.query.targetUrl,a=void 0===o?"/mine":o,this.$router.replace(a));case 4:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()})),Object(s["b"])("user",{login3:"login",login4:function(t,e){var n=this;return Object(x["a"])(regeneratorRuntime.mark((function r(){var o,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t("login",e);case 2:o=r.sent,200===o.code&&(n.$toast("登录成功"),a=n.$route.query.targetUrl,i=void 0===a?"/mine":a,n.$router.replace(i));case 4:case"end":return r.stop()}}),r)})))()}})),{},{onSubmit:function(t){var e=this;return Object(x["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("values",t),e.login4(t);case 2:case"end":return n.stop()}}),n)})))()}})}),$=k,O=Object(l["a"])($,y,w,!1,null,null,null),j=O.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v(" Reg ")])},q=[],I={name:"Reg"},L=I,E=Object(l["a"])(L,S,q,!1,null,null,null),z=E.exports,R=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v(" Discover ")])},A=[],P={name:"Discover"},U=P,T=Object(l["a"])(U,R,A,!1,null,null,null),C=T.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-nav-bar",{attrs:{title:"购物车","left-text":"返回","left-arrow":""},scopedSlots:t._u([{key:"left",fn:function(){return[n("van-icon",{staticStyle:{"margin-right":"5px"},attrs:{name:"arrow-left",size:"20"},on:{click:function(e){return t.$router.back()}}}),n("van-icon",{attrs:{name:"wap-home-o",size:"20"},on:{click:function(e){return t.goto("/home")}}})]},proxy:!0},{key:"right",fn:function(){return[n("van-icon",{attrs:{name:"edit",size:"20"},on:{click:function(e){t.edit=!t.edit}}})]},proxy:!0}])}),n("van-steps",{attrs:{active:0}},[n("van-step",[t._v("1.购物车")]),n("van-step",[t._v("2.下单")]),n("van-step",[t._v("3.支付")]),n("van-step",[t._v("4.购买成功")])],1),0===t.cartlist.length?n("van-empty",{attrs:{description:"购物车空空的"}},[n("van-button",{attrs:{round:"",plain:"",type:"primary",size:"small"},on:{click:function(e){return t.goto("/discover")}}},[t._v("去购买")])],1):t._l(t.cartlist,(function(e){return n("van-swipe-cell",{key:e._id,scopedSlots:t._u([{key:"right",fn:function(){return[n("van-button",{staticStyle:{height:"100%"},attrs:{size:"mini",square:"",type:"danger",text:"删除"},on:{click:function(n){return t.remove(e._id)}}})]},proxy:!0}],null,!0)},[n("van-row",{staticStyle:{"padding-left":"15px"},attrs:{type:"flex",align:"center"}},[n("van-col",{attrs:{span:"2"}},[n("van-checkbox",{attrs:{value:t.selectIds.includes(e._id)},on:{click:function(n){return t.selectItem(e._id)}}})],1),n("van-col",{attrs:{span:"22"}},[n("van-card",{staticStyle:{"padding-left":"0","background-color":"#fff"},attrs:{"thumb-link":"#/goods/"+e._id,thumb:t.$request.baseUrl+e.img_url,"origin-price":e.price,price:e.sales_price,title:e.goods_name,num:e.qty},scopedSlots:t._u([{key:"num",fn:function(){return[n("van-stepper",{attrs:{value:e.qty,name:e._id,theme:"round","button-size":"20px","disable-input":""},on:{change:t.changeGoodsQty}})]},proxy:!0}],null,!0)})],1)],1)],1)})),n("van-submit-bar",{attrs:{price:t.totalPrice,"button-text":"去结算"},on:{submit:t.onSubmit},scopedSlots:t._u([t.edit?{key:"button",fn:function(){return[n("div",[n("van-button",{attrs:{size:"mini",type:"primary",plain:"",round:""}},[t._v("加入收藏")]),n("van-button",{attrs:{size:"mini",type:"danger",plain:"",round:""},on:{click:t.remove}},[t._v("批量删除")])],1)]},proxy:!0}:null],null,!0)},[n("van-checkbox",{model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}},[t._v("全选")])],1)],2)},G=[],N=(n("d3b7"),n("caad"),n("2532"),n("d81d"),n("b0c0"),n("a434"),{name:"Cart",data:function(){return{edit:!1,selectIds:[]}},computed:{totalPrice:function(){return 100*this.$store.getters.totalPrice},selectAll:{get:function(){var t=this;return this.cartlist.every((function(e){return t.selectIds.includes(e._id)}))},set:function(t){this.selectIds=t?this.cartlist.map((function(t){return t._id})):[]}},cartlist:function(){return this.$store.state.cart.cartlist}},created:function(){},methods:{changeGoodsQty:function(t,e){console.log("changeQty",t,e),this.$store.commit("changeqty",{_id:e.name,qty:t})},goto:function(t){this.$router.push(t)},onSubmit:function(){},selectItem:function(t){var e=this.selectIds.indexOf(t);e>=0?this.selectIds.splice(e,1):this.selectIds.push(t)},remove:function(t){"string"===typeof t?this.$store.commit("remove",{_id:t}):this.$store.commit("remove",{_id:this.selectIds})}}}),H=N,J=Object(l["a"])(H,D,G,!1,null,null,null),M=J.exports,Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"15px"}},[t.isLogin?[n("p",[t._v(" "+t._s(t.userInfo.username)+" ")]),n("van-button",{attrs:{block:"",type:"danger"},on:{click:t.logout}},[t._v("退出")])]:n("van-button",{attrs:{block:"",type:"primary"},on:{click:function(e){return t.$router.push("/login")}}},[t._v("登录")])],2)},F=[],B={name:"Mine",computed:{userInfo:function(){return this.$store.state.user.userInfo},isLogin:function(){return this.$store.getters.isLogin}},methods:{logout:function(){this.$store.commit("logout")}}},K=B,V=Object(l["a"])(K,Q,F,!1,null,null,null),W=V.exports,X=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-search",{attrs:{placeholder:"请输入搜索关键词"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),t._v(" Search List ")],1)},Y=[],Z={name:"Search",data:function(){return{keyword:this.$route.query.keyword||""}}},tt=Z,et=Object(l["a"])(tt,X,Y,!1,null,null,null),nt=et.exports,rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-nav-bar",{attrs:{title:t.data.goods_name,"left-text":"返回","left-arrow":""},scopedSlots:t._u([{key:"left",fn:function(){return[n("van-icon",{staticStyle:{"margin-right":"5px"},attrs:{name:"arrow-left",size:"20"},on:{click:function(e){return t.$router.back()}}}),n("van-icon",{attrs:{name:"wap-home-o",size:"20"},on:{click:function(e){return t.goto("/home")}}})]},proxy:!0},{key:"right",fn:function(){return[n("van-icon",{attrs:{name:"share-o",size:"20"}})]},proxy:!0}])}),n("van-image",{attrs:{width:"100%",src:t.$request.baseUrl+t.data.img_url}}),n("h5",[t._v(t._s(t.data.goods_name))]),n("p",{staticClass:"price"},[n("del",[t._v(t._s(t.data.price))]),n("span",[t._v(t._s(t.data.sales_price))])]),n("h4",[t._v(t._s(t.data.category)+"相关商品")]),n("van-row",{attrs:{gutter:"20"}},t._l(t.showlist,(function(e){return n("van-col",{key:e._id,staticStyle:{height:"260px"},attrs:{span:"12"}},[n("div",{staticStyle:{"text-align":"center"},on:{click:function(n){return t.goto("/goods/"+e._id)}}},[n("van-image",{attrs:{width:"100",height:"100",src:t.$request.baseUrl+e.img_url}})],1),n("h5",[t._v(t._s(e.goods_name))]),n("p",{staticClass:"price"},[n("del",[t._v(t._s(e.price))]),n("span",[t._v(t._s(e.sales_price))])])])})),1),n("van-goods-action",[n("van-goods-action-icon",{attrs:{icon:"chat-o",text:"客服",dot:""}}),n("van-goods-action-icon",{attrs:{icon:"cart-o",text:"购物车",badge:t.cartlist.length},on:{click:function(e){return t.goto("/cart")}}}),n("van-goods-action-icon",{attrs:{icon:"shop-o",text:"店铺",badge:"12"}}),n("van-goods-action-button",{attrs:{type:"warning",text:"加入购物车"},on:{click:t.addToCart}}),n("van-goods-action-button",{attrs:{type:"danger",text:"立即购买"},on:{click:t.buyNow}})],1)],1)},ot=[],at=(n("fb6a"),n("4de4"),n("7db0"),{name:"Goods",data:function(){return{data:{},goodslist:[]}},computed:{showlist:function(){var t=this;return this.goodslist.filter((function(e){return e._id!==t.data._id})).slice(0,6)},cartlist:function(){return this.$store.state.cart.cartlist}},watch:{"$route.params.id":function(t,e){console.log("watch=",t,e)}},created:function(){console.log("Goods.created",this),this.getData(),this.$parent.showTabbar=!1},destroyed:function(){this.$parent.showTabbar=!0},beforeRouteUpdate:function(t,e,n){console.log("Goods.beforeRouteUpdate",t,e);var r=t.params.id;this.getData(r),n()},methods:{goto:function(t){this.$router.push(t)},getData:function(t){var e=this,n=t||this.$route.params.id;this.$request.get("/goods/"+n).then((function(t){var n=t.data;console.log("goods",n),e.data=n.data,0===e.goodslist.length&&e.getList(n.data.category)}))},getList:function(t){var e=this;this.$request("/goods",{params:{category:t,total:!1,size:8}}).then((function(t){var n=t.data;e.goodslist=n.data}))},addToCart:function(){var t=this.data,e=t._id,n=t.goods_name,r=t.price,o=t.sales_price,a=t.img_url,i=this.cartlist.find((function(t){return t._id===e}));if(i)this.$store.commit("changeqty",{_id:e,qty:i.qty+1});else{var s={_id:e,goods_name:n,price:r,sales_price:o,img_url:a,qty:1};this.$store.commit("add",s)}},buyNow:function(){this.addToCart(),this.goto("/cart")}}}),it=at,st=(n("3f86"),Object(l["a"])(it,rt,ot,!1,null,"6526538c",null)),ct=st.exports,ut=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v(" 您访问的页面不存在 ")])},lt=[],dt={name:"NotFound"},ft=dt,pt=Object(l["a"])(ft,ut,lt,!1,null,null,null),ht=pt.exports;r["a"].use(p["a"]);var gt=new p["a"]({routes:[{path:"/",redirect:"/home"},{path:"/home",component:_,name:"Home",beforeEnter:function(t,e,n){console.log("Home.beforeEnter"),n()}},{path:"/reg",component:z},{path:"/login",component:j},{path:"/discover",component:C},{path:"/cart",component:M,meta:{requireAuth:!0}},{path:"/mine",component:W,meta:{requireAuth:!0}},{path:"/search",component:nt},{path:"/goods/:id",component:ct,name:"Goods",beforeEnter:function(t,e,n){console.log("Goods.beforeEnter"),n()}},{path:"/notfound",component:ht},{path:"*",redirect:"/notfound"}]});console.log("router",gt),gt.beforeEach((function(t,e,n){if(console.log("beforeEach"),t.meta.requireAuth){var r=localStorage.getItem("userInfo");try{r=JSON.parse(r)||{}}catch(o){r={}}r._id?(gt.app.$request.get("/user/verify",{params:{username:r.username},headers:{Authorization:r.authorization}}).then((function(e){var n=e.data;401===n.code&&(localStorage.removeItem("userInfo"),gt.push({path:"/login",query:{targetUrl:t.fullPath}}))})),n()):gt.push({path:"/login",query:{targetUrl:t.fullPath}})}else n()}));var mt=gt,vt=n("bc3a"),bt=n.n(vt),_t="http://120.76.247.5:2003",yt=bt.a.create({baseURL:_t+"/api"});yt.baseUrl=_t;var wt=yt;n("e9c4");function xt(t,e){localStorage.setItem(t,JSON.stringify(e))}var kt=localStorage.getItem("userInfo");try{kt=JSON.parse(kt)||{}}catch(Lt){kt={}}var $t={namespaced:!0,state:{userInfo:kt},getters:{isLogin:function(t,e,n,r){return console.log("user.getters=",t,e,n,r),!!t.userInfo.authorization}},mutations:{login:function(t,e){console.log("mutations",arguments),t.userInfo=e,xt("userInfo",e)},logout:function(t){t.userInfo={},xt("userInfo",{})}},actions:{login:function(t,e){return Object(x["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("context",t),n.next=3,wt.post("/login",e);case 3:return r=n.sent,o=r.data,t.commit("login",o.data),n.abrupt("return",o);case 7:case"end":return n.stop()}}),n)})))()}}},Ot=(n("159b"),localStorage.getItem("cartlist"));try{Ot=JSON.parse(Ot)||[]}catch(Lt){Ot=[]}var jt={state:{cartlist:Ot},getters:{totalPrice:function(t,e){return t.cartlist.reduce((function(t,e){return t+e.sales_price*e.qty}),0)}},mutations:{add:function(t,e){t.cartlist.unshift(e),xt("cartlist",t.cartlist)},changeqty:function(t,e){var n=e._id,r=e.qty;t.cartlist.forEach((function(t){t._id===n&&(t.qty=r)})),xt("cartlist",t.cartlist)},remove:function(t,e){var n=e._id;Array.isArray(n)||(n=[n]),t.cartlist=t.cartlist.filter((function(t){return!n.includes(t._id)})),xt("cartlist",t.cartlist)}},actions:{globalLogin:function(){console.log("cart.globalLogin")}}};r["a"].use(s["a"]);var St=new s["a"].Store({state:{index:10,a:20},getters:{globalA:function(){return 100}},mutations:{},actions:{globalLogin:function(){console.log("globalLogin")}},modules:{user:$t,cart:jt}});console.log("store",St),St.dispatch({type:"globalLogin"});var qt=St,It=n("b970");n("157a");r["a"].use(It["a"]),r["a"].prototype.$request=wt,r["a"].config.productionTip=!1,new r["a"]({router:mt,store:qt,render:function(t){return t(f)}}).$mount("#app")},"85ec":function(t,e,n){},"9ccd":function(t,e,n){"use strict";n("1b71")},aa7e:function(t,e,n){}});
//# sourceMappingURL=app.91083d4b.js.map